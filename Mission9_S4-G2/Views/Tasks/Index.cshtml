@model IEnumerable<Mission9_S4_G2.Models.Task>
@{
    ViewData["Title"] = "Quadrants";
    var tasks = Model ?? Enumerable.Empty<Mission9_S4_G2.Models.Task>();
    var incomplete = tasks.Where(t => !t.Completed);
    var q1 = incomplete.Where(t => t.Quadrant == 1);
    var q2 = incomplete.Where(t => t.Quadrant == 2);
    var q3 = incomplete.Where(t => t.Quadrant == 3);
    var q4 = incomplete.Where(t => t.Quadrant == 4);
}

<div class="container-fluid">
    <h1 class="mb-4">Quadrants</h1>
    <p class="text-muted mb-4">Tasks organized by Stephen Covey&apos;s &quot;First Things First&quot; priority matrix. Only incomplete tasks are shown.</p>

    @if (!incomplete.Any())
    {
        <div class="alert alert-info" role="alert">
            <strong>No incomplete tasks.</strong> <a asp-controller="Tasks" asp-action="Create">Add a task</a> to get started.
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">Quadrant I: Important / Urgent</h5>
                    </div>
                    <div class="card-body">
                        @if (!q1.Any())
                        {
                            <p class="text-muted mb-0">No tasks. <a asp-controller="Tasks" asp-action="Create">Add a task</a>.</p>
                        }
                        else
                        {
                            @foreach (var task in q1)
                            {
                                <div class="border rounded p-2 mb-2">
                                    <strong>@task.TaskName</strong>
                                    <br />
                                    <small class="text-muted">Due: @(string.IsNullOrEmpty(task.DueDate) ? "—" : task.DueDate) | Category: @(task.CategoryName?.CategoryName ?? "—")</small>
                                    <div class="mt-2">
                                        <a asp-controller="Tasks" asp-action="Edit" asp-route-id="@task.TaskId" class="btn btn-primary btn-sm">Edit</a>
                                        <form asp-controller="Tasks" asp-action="Delete" asp-route-id="@task.TaskId" method="post" class="d-inline" onsubmit="return confirm('Delete this task?');">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                        <form asp-controller="Tasks" asp-action="MarkCompleted" asp-route-id="@task.TaskId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-success btn-sm">Complete</button>
                                        </form>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">Quadrant II: Important / Not Urgent</h5>
                    </div>
                    <div class="card-body">
                        @if (!q2.Any())
                        {
                            <p class="text-muted mb-0">No tasks. <a asp-controller="Tasks" asp-action="Create">Add a task</a>.</p>
                        }
                        else
                        {
                            @foreach (var task in q2)
                            {
                                <div class="border rounded p-2 mb-2">
                                    <strong>@task.TaskName</strong>
                                    <br />
                                    <small class="text-muted">Due: @(string.IsNullOrEmpty(task.DueDate) ? "—" : task.DueDate) | Category: @(task.CategoryName?.CategoryName ?? "—")</small>
                                    <div class="mt-2">
                                        <a asp-controller="Tasks" asp-action="Edit" asp-route-id="@task.TaskId" class="btn btn-primary btn-sm">Edit</a>
                                        <form asp-controller="Tasks" asp-action="Delete" asp-route-id="@task.TaskId" method="post" class="d-inline" onsubmit="return confirm('Delete this task?');">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                        <form asp-controller="Tasks" asp-action="MarkCompleted" asp-route-id="@task.TaskId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-success btn-sm">Complete</button>
                                        </form>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Quadrant III: Not Important / Urgent</h5>
                    </div>
                    <div class="card-body">
                        @if (!q3.Any())
                        {
                            <p class="text-muted mb-0">No tasks. <a asp-controller="Tasks" asp-action="Create">Add a task</a>.</p>
                        }
                        else
                        {
                            @foreach (var task in q3)
                            {
                                <div class="border rounded p-2 mb-2">
                                    <strong>@task.TaskName</strong>
                                    <br />
                                    <small class="text-muted">Due: @(string.IsNullOrEmpty(task.DueDate) ? "—" : task.DueDate) | Category: @(task.CategoryName?.CategoryName ?? "—")</small>
                                    <div class="mt-2">
                                        <a asp-controller="Tasks" asp-action="Edit" asp-route-id="@task.TaskId" class="btn btn-primary btn-sm">Edit</a>
                                        <form asp-controller="Tasks" asp-action="Delete" asp-route-id="@task.TaskId" method="post" class="d-inline" onsubmit="return confirm('Delete this task?');">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                        <form asp-controller="Tasks" asp-action="MarkCompleted" asp-route-id="@task.TaskId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-success btn-sm">Complete</button>
                                        </form>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">Quadrant IV: Not Important / Not Urgent</h5>
                    </div>
                    <div class="card-body">
                        @if (!q4.Any())
                        {
                            <p class="text-muted mb-0">No tasks. <a asp-controller="Tasks" asp-action="Create">Add a task</a>.</p>
                        }
                        else
                        {
                            @foreach (var task in q4)
                            {
                                <div class="border rounded p-2 mb-2">
                                    <strong>@task.TaskName</strong>
                                    <br />
                                    <small class="text-muted">Due: @(string.IsNullOrEmpty(task.DueDate) ? "—" : task.DueDate) | Category: @(task.CategoryName?.CategoryName ?? "—")</small>
                                    <div class="mt-2">
                                        <a asp-controller="Tasks" asp-action="Edit" asp-route-id="@task.TaskId" class="btn btn-primary btn-sm">Edit</a>
                                        <form asp-controller="Tasks" asp-action="Delete" asp-route-id="@task.TaskId" method="post" class="d-inline" onsubmit="return confirm('Delete this task?');">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                        <form asp-controller="Tasks" asp-action="MarkCompleted" asp-route-id="@task.TaskId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-success btn-sm">Complete</button>
                                        </form>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>
